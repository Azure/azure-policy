{
  "properties": {
    "displayName": "Storage Account should restrict Cross Tenant Replication",
    "policyType": "BuiltIn",
    "mode": "Indexed",
    "description": "This policy helps enforce data residency and security boundaries by preventing cross-tenant replication of storage accounts. It ensures that object replication policies do not inadvertently replicate data to storage accounts outside the intended tenant. Use exclusions to allow specific storage accounts where cross-tenant replication is explicitly approved.",
    "metadata": {
      "version": "1.0.0",
      "category": "MissionPlatforms"
    },
    "version": "1.0.0",
    "parameters": {
      "effect": {
        "type": "String",
        "metadata": {
          "displayName": "Storage Account Disable External replicaton effect",
          "description": "Specify the Storage Account Disable External replicaton effect"
        },
        "allowedValues": [
          "Modify",
          "Disabled"
        ],
        "defaultValue": "Disabled"
      },
      "excludedStorageAccounts": {
        "type": "Array",
        "metadata": {
          "description": "The list of excluded Storage accounts",
          "displayName": "Excluded Storage Accounts"
        },
        "defaultValue": []
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.Storage/storageAccounts"
          },
          {
            "allOf": [
              {
                "field": "Microsoft.Storage/storageAccounts/allowCrossTenantReplication",
                "notEquals": false
              },
              {
                "field": "name",
                "notin": "[parameters('excludedStorageAccounts')]"
              }
            ]
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]",
        "details": {
          "roleDefinitionIds": [
            "/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab",
            "/providers/Microsoft.Authorization/roleDefinitions/f1a07417-d97a-45cb-824c-7a7467783830"
          ],
          "operations": [
            {
              "operation": "addOrReplace",
              "field": "Microsoft.Storage/storageAccounts/allowCrossTenantReplication",
              "value": false
            }
          ]
        }
      }
    },
    "versions": [
      "1.0.0"
    ]
  },
  "id": "/providers/Microsoft.Authorization/policyDefinitions/405abc16-652e-41d1-91cc-4b44389e03a1",
  "name": "405abc16-652e-41d1-91cc-4b44389e03a1"
}